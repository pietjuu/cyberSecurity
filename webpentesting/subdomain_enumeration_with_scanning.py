import subprocess
import os
from datetime import datetime

# Define the target domain
target_domain = input("Enter the target domain like example.com: ")

# Create a timestamp for the log files
timestamp = datetime.now().strftime("%Y%m%d%H%M%S")

# Create a directory to store results if it doesn't exist
results_directory = f"scan_results_{timestamp}"
os.makedirs(results_directory, exist_ok=True)

# Step 1: Use subfinder to find subdomains
subfinder_command = f"subfinder -d {target_domain} -o {results_directory}/subdomains.txt"
subprocess.run(subfinder_command, shell=True)

# Step 2: Use dnsx to resolve IP addresses
dnsx_command = f"dnsx -l {results_directory}/subdomains.txt -o {results_directory}/resolved_ips.txt"
subprocess.run(dnsx_command, shell=True)

# Step 3: Use gobuster to find hidden directories and files
# Adjust the wordlist and other options as needed
gobuster_command = f"gobuster dir -u https://{target_domain}/ -w wordlist/common.txt -t 50 -x php,html -o {results_directory}/gobuster_results.txt"
subprocess.run(gobuster_command, shell=True)

# Step 4: Use httpx to check the status codes and response headers
gobuster_command = (f"gobuster dir -u https://{target_domain}/ -w wordlist/common.txt -t 50 -x php,html -o "
                    f"{results_directory}/gobuster_results.txt -s 301")
subprocess.run(gobuster_command, shell=True)

# Step 5: Log the results
with open(f"{results_directory}/httpx_results.txt", "r") as httpx_results_file:
    httpx_results = httpx_results_file.read()

with open(f"{results_directory}/gobuster_results.txt", "r") as gobuster_results_file:
    gobuster_results = gobuster_results_file.read()

# Save the results to a summary file
summary_filename = f"{results_directory}/scan_summary.txt"
with open(summary_filename, "w") as summary_file:
    summary_file.write("Subdomain Enumeration Results:\n")
    summary_file.write(f"Target Domain: {target_domain}\n")
    summary_file.write(f"Timestamp: {timestamp}\n\n")

    summary_file.write("HTTP Status Code and Header Results:\n")
    summary_file.write(httpx_results)

    summary_file.write("\n\nDirectory Enumeration Results:\n")
    summary_file.write(gobuster_results)

# Clean up temporary files
os.remove(f"{results_directory}/subdomains.txt")
os.remove(f"{results_directory}/resolved_ips.txt")
os.remove(f"{results_directory}/gobuster_results.txt")
os.remove(f"{results_directory}/httpx_results.txt")

print(f"Scan results are saved in the '{results_directory}' directory.")
